///$tab Main
SET ThousandSep=',';
SET DecimalSep='.';
SET MoneyThousandSep=',';
SET MoneyDecimalSep='.';
SET MoneyFormat='$#,##0.00;($#,##0.00)';
SET TimeFormat='h:mm:ss TT';
SET DateFormat='M/D/YYYY';
SET TimestampFormat='M/D/YYYY h:mm:ss[.fff] TT';
SET MonthNames='Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec';
SET DayNames='Mon;Tue;Wed;Thu;Fri;Sat;Sun';








///$tab Auto-generated section
///$autogenerated

[FinalItemMaster]:
LOAD [Short Name],
	[Item Count],
	[Product Price Group],
	[Product Department],
	[Product Line],
	[Product Line Desc],
	[Product Group],
	[Product Group Desc],
	[Product Type],
	[Master Planning Family],
	[Product Sub Group]
 FROM [lib://AttachedFiles/FinalItemMaster.qvd]
(qvd);

[AggSales]:
LOAD [AggKey],
	[YTD Sales Amount],
	[LY YTD Sales Amount],
	[TM Sales Amount],
	[LY TM Sales Amount],
	[LY Tot Sales Amount],
	[YTD Sales Margin Amount],
	[LY YTD Sales Margin Amount],
	[TM Sales Margin Amount],
	[LY TM Sales Margin Amount],
	[LY Tot Sales Margin Amount],
	[Current Open Amount],
	[Current BackOrder Amount],
	[Current Backlog Amount]
 FROM [lib://AttachedFiles/AggSales.qvd]
(qvd);

[CustomerAddress]:
LOAD 
	[Address Number] AS [Address Number],
	[Customer Address 1] AS [Customer Address 1],
	[Customer Address 2] AS [Customer Address 2],
	[Customer Address 3] AS [Customer Address 3],
	[Customer Address 4] AS [Customer Address 4],
	[Zip Code] AS [Zip Code],
	[City] AS [City],
	[County] AS [County],
	[State] AS [State-USStates.Name],
	[Country] AS [Country];
LOAD [Address Number],
	[Customer Address 1],
	[Customer Address 2],
	[Customer Address 3],
	[Customer Address 4],
	[Zip Code],
	[City],
	[County],
	[State],
	[Country]
 FROM [lib://AttachedFiles/CustomerAddress.qvd]
(qvd);

[Customers]:
LOAD [Division],
	[Division Name],
	[Business Family],
	[Customer Type],
	[Customer Type Name],
	[Channel],
	[Channel Name],
	[Category Code 5],
	[Zone Mgr],
	[Zone Mgr Name],
	[Category Code 7],
	[Regional Sales Mgr],
	[Regional Sales Mgr Name],
	[Distribution Channel Mgr],
	[Distribution Channel Mgr Name],
	[Region Code],
	[Region Name],
	[Price Discount Cde 4],
	[Line of Business],
	[Sales Volume],
	[Customer],
	[Address Number],
	[Customer Number],
	[Consolidated],
	[Search Type],
	[Phone],
	[Business Unit],
	[SIC Code],
	[Tax Certificate]
 FROM [lib://AttachedFiles/Customers.qvd]
(qvd);

[FinalItemBranch]:
LOAD [Item Branch 3rd Item Number],
	[Item Branch G/L Category],
	[Short Name],
	[Item Branch 2nd Item Number],
	[Item-Branch Key],
	[Item Branch Reorder Quantity],
	[Horsepower],
	[Item Branch Category Code 6],
	[Item Branch Category Code 7],
	[Item Branch Primary Supplier]
 FROM [lib://AttachedFiles/FinalItemBranch.qvd]
(qvd);

[FinalSalesHeader]:
LOAD [Order Number],
	[Address Number Header],
	[Order Gross Amount],
	[Order Type Header],
	[Business Unit Order Header],
	[Order Date Header],
	[Hold Orders Code Header],
	[Company Number Header],
	[Stop Code Header],
	[Zone Code Header],
	[Hold Code Header],
	[Ship To Address Header],
	[Parent Address Number Header],
	[Orderby Header],
	[Freight Code Header]
 FROM [lib://AttachedFiles/FinalSalesHeader.qvd]
(qvd);

[FinalYTDBudget]:
LOAD [BudKey],
	[YTD Budget Amount],
	[TM Budget Amount]
 FROM [lib://AttachedFiles/FinalYTDBudget.qvd]
(qvd);

[Province]:
LOAD 
	[State] AS [State-USStates.Name],
	[state_abbr] AS [state_abbr],
	[state_name] AS [state_name];
LOAD [State],
	[state_abbr],
	[state_name]
 FROM [lib://AttachedFiles/Province.qvd]
(qvd);

[Sales]:
LOAD [NoOfItem],
	[MaxNoOfItem],
	[Key]
 FROM [lib://AttachedFiles/Sales.qvd]
(qvd);

[US STATES]:
LOAD 
	[USStates.Name] AS [State-USStates.Name],
	[USStates.Area] AS [USStates.Area];
LOAD [USStates.Name],
	[USStates.Area]
 FROM [lib://AttachedFiles/USStates.kml]
(kml, Table is [US STATES]);

[SalesDetails2]:
LOAD [Address Number],
	[BudKey],
	[AggKey],
	[Ship To],
	[Sales Rep],
	[Sales Rep Name],
	[Item Class],
	[Item Class Desc],
	[CustKey],
	[Family Class],
	[Sales Amount Based on List Price],
	[Line Desc 1],
	[Invoice Number],
	[Backlog Amount],
	[Sales Quantity],
	[Qty Backordered],
	[Actual Delivery Date],
	[Last Status],
	[Number Of Days Late],
	[Doc Type],
	[Order Status Primary],
	[Order Status],
	[Line Number],
	[Item Number],
	[Line Type],
	[List Price],
	[Sales Cost Amount],
	[Order Margin],
	[Open Order Cost Amount],
	[Discount Amount],
	[Invoice Date],
	[Company Number Detail],
	[Payment Terms],
	[Sales Unit Cost Price],
	[Open Order Quantity],
	[Unit Price],
	[Business Unit Details],
	[Next Status],
	[Promised Delivery Date],
	[Sales Margin Amount],
	[U/M],
	[Parent Address Number],
	[Open Order Amount],
	[Sales Amount],
	[BackOrder Amount],
	[Sales Price],
	[Address Order Number],
	[Late Shipment],
	[Order Type Detail],
	[Shipments],
	[DateKey],
	[Order Number],
	[Item-Branch Key],
	[Key]
 FROM [lib://AttachedFiles/SalesDetails2.qvd]
(qvd);

[Dates3]:
LOAD [DateKey],
	[Date],
	[Day],
	[Month],
	[Week],
	[Weekday],
	[Year],
	[YearMonth]
 FROM [lib://AttachedFiles/Dates3.qvd]
(qvd);



[autoCalendar]: 
  DECLARE FIELD DEFINITION Tagged ('$date')
FIELDS
  Dual(Year($1), YearStart($1)) AS [Year] Tagged ('$axis', '$year'),
  Dual('Q'&Num(Ceil(Num(Month($1))/3)),Num(Ceil(NUM(Month($1))/3),00)) AS [Quarter] Tagged ('$quarter', '$cyclic'),
  Dual(Year($1)&'-Q'&Num(Ceil(Num(Month($1))/3)),QuarterStart($1)) AS [YearQuarter] Tagged ('$yearquarter', '$qualified'),
  Dual('Q'&Num(Ceil(Num(Month($1))/3)),QuarterStart($1)) AS [_YearQuarter] Tagged ('$yearquarter', '$hidden', '$simplified'),
  Month($1) AS [Month] Tagged ('$month', '$cyclic'),
  Dual(Year($1)&'-'&Month($1), monthstart($1)) AS [YearMonth] Tagged ('$axis', '$yearmonth', '$qualified'),
  Dual(Month($1), monthstart($1)) AS [_YearMonth] Tagged ('$axis', '$yearmonth', '$simplified', '$hidden'),
  Dual('W'&Num(Week($1),00), Num(Week($1),00)) AS [Week] Tagged ('$weeknumber', '$cyclic'),
  Date(Floor($1)) AS [Date] Tagged ('$axis', '$date', '$qualified'),
  Date(Floor($1), 'D') AS [_Date] Tagged ('$axis', '$date', '$hidden', '$simplified');

DERIVE FIELDS FROM FIELDS [Date] USING [autoCalendar] ;///$tab Distribution List
Replace LOAD
    "Name" AS [DL_DISTRIBUTION_RECIPIENT_NAME],
    "Email" AS [DL_DISTRIBUTION_EMAIL],
    SubField([Filters],',') AS [DL_DISTRIBUTION_FILTERS],
    SubField([Groups],',') AS [DL_DISTRIBUTION_GROUP_NAMES]
FROM "lib://Demo:DataFiles/reporting_source_d6152f1d-c366-4471-8aa6-7ae473e63f59.xlsx"
(ooxml, embedded labels, table is DL_DISTRIBUTION_SVC_USERS_QCS);

TempGroups:
	REPLACE LOAD
    	*
    FROM "lib://Demo:DataFiles/reporting_source_d6152f1d-c366-4471-8aa6-7ae473e63f59.xlsx"
    (ooxml, embedded labels, table is DL_DISTRIBUTION_SVC_GROUPS_QCS);

let vEnabledFieldNo = FieldNumber('Enabled', 'TempGroups');

if (vEnabledFieldNo > 0) then
    DL_DISTRIBUTION_SVC_GROUPS_QCS:
    REPLACE LOAD
        "Name" AS [DL_DISTRIBUTION_GROUP_NAMES],
        "Description" AS [DL_DISTRIBUTION_GROUP_DESCRIPTION],
        "Enabled" AS [DL_DISTRIBUTION_GROUP_ENABLED]
    Resident TempGroups;
else

    DL_DISTRIBUTION_SVC_GROUPS_QCS:
    REPLACE LOAD
        "Name" AS [DL_DISTRIBUTION_GROUP_NAMES],
        "Description" AS [DL_DISTRIBUTION_GROUP_DESCRIPTION],
        1 AS [DL_DISTRIBUTION_GROUP_ENABLED]
    Resident TempGroups;
end if

Drop Table TempGroups;

tag field DL_DISTRIBUTION_RECIPIENT_NAME with 'DL_DISTRIBUTION_SVC__recipientName';
tag field DL_DISTRIBUTION_EMAIL with 'DL_DISTRIBUTION_SVC__recipientEmail';
tag field DL_DISTRIBUTION_FILTERS with 'DL_DISTRIBUTION_SVC__recipientFilters';
tag field DL_DISTRIBUTION_GROUP_NAMES with 'DL_DISTRIBUTION_SVC__groupsName';
tag field DL_DISTRIBUTION_GROUP_DESCRIPTION with 'DL_DISTRIBUTION_SVC__groupDescription';
tag field DL_DISTRIBUTION_GROUP_ENABLED with 'DL_DISTRIBUTION_SVC__groupEnabled';
